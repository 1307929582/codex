# å¥—é¤+æ”¯ä»˜ç³»ç»Ÿ - å®Œæ•´å®ç°å®Œæˆ

## âœ… å·²å®ŒæˆåŠŸèƒ½

### åç«¯å®ç°
- [x] æ•°æ®åº“è®¾è®¡ï¼ˆpackages, user_packages, daily_usage, payment_ordersï¼‰
- [x] å¥—é¤ç®¡ç†APIï¼ˆCRUDæ“ä½œï¼‰
- [x] Creditæ”¯ä»˜é›†æˆï¼ˆç­¾åç”Ÿæˆã€å›è°ƒéªŒè¯ï¼‰
- [x] è®¡è´¹é€»è¾‘ï¼ˆä¼˜å…ˆä½¿ç”¨å¥—é¤é¢åº¦ï¼‰
- [x] æ¯æ—¥é™é¢è‡ªåŠ¨é‡ç½®ï¼ˆUTC+8æ—¶åŒºï¼‰
- [x] å¥—é¤è¿‡æœŸè‡ªåŠ¨æ£€æŸ¥
- [x] æ‰€æœ‰å¿…è¦çš„è·¯ç”±é…ç½®

### å‰ç«¯å®ç°
- [x] ç®¡ç†å‘˜å¥—é¤ç®¡ç†é¡µé¢ï¼ˆ/admin/packagesï¼‰
- [x] ç®¡ç†å‘˜Credité…ç½®ç•Œé¢ï¼ˆ/admin/settingsï¼‰
- [x] ç”¨æˆ·å¥—é¤è´­ä¹°é¡µé¢ï¼ˆ/packagesï¼‰
- [x] ç”¨æˆ·Dashboardå¥—é¤çŠ¶æ€æ˜¾ç¤º
- [x] å¯¼èˆªèœå•æ›´æ–°

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. æ‹‰å–æœ€æ–°ä»£ç 
```bash
git pull
```

### 2. è¿è¡Œæ•°æ®åº“è¿ç§»
```bash
docker exec codex-gateway-db-1 psql -U postgres -d codex_gateway < migrations/add_packages_and_payment.sql
```

### 3. é‡æ–°æ„å»ºå¹¶å¯åŠ¨æœåŠ¡
```bash
docker compose up -d --build
```

### 4. é…ç½®Creditæ”¯ä»˜

ç™»å½•ç®¡ç†å‘˜è´¦å·ï¼Œè¿›å…¥ç³»ç»Ÿè®¾ç½®é¡µé¢ï¼š

1. **å¯ç”¨Creditæ”¯ä»˜**ï¼šæ‰“å¼€å¼€å…³
2. **é…ç½®PID**ï¼šè¾“å…¥æ‚¨çš„Linux Do Credit Client ID
3. **é…ç½®Key**ï¼šè¾“å…¥æ‚¨çš„Linux Do Credit Client Secret
4. **é…ç½®Notify URL**ï¼š`https://your-domain.com/api/payment/credit/notify`
5. **é…ç½®Return URL**ï¼š`https://your-domain.com/packages`
6. **ä¿å­˜æ›´æ”¹**

### 5. åˆ›å»ºå¥—é¤

è¿›å…¥å¥—é¤ç®¡ç†é¡µé¢ï¼ˆ/admin/packagesï¼‰ï¼š

1. ç‚¹å‡»"åˆ›å»ºå¥—é¤"
2. å¡«å†™å¥—é¤ä¿¡æ¯ï¼š
   - åç§°ï¼šå¦‚"åŸºç¡€å¥—é¤"
   - æè¿°ï¼šå¦‚"é€‚åˆè½»åº¦ä½¿ç”¨"
   - ä»·æ ¼ï¼šå¦‚ 30.00
   - æœ‰æ•ˆæœŸï¼šå¦‚ 30 å¤©
   - æ¯æ—¥é™é¢ï¼šå¦‚ 5.00
   - æ’åºï¼šæ•°å­—è¶Šå°è¶Šé å‰
3. ä¿å­˜

## ğŸ“– ä½¿ç”¨è¯´æ˜

### ç®¡ç†å‘˜åŠŸèƒ½

#### å¥—é¤ç®¡ç†ï¼ˆ/admin/packagesï¼‰
- **åˆ›å»ºå¥—é¤**ï¼šç‚¹å‡»"åˆ›å»ºå¥—é¤"æŒ‰é’®
- **ç¼–è¾‘å¥—é¤**ï¼šç‚¹å‡»å¥—é¤å¡ç‰‡ä¸Šçš„ç¼–è¾‘å›¾æ ‡
- **å¯ç”¨/ç¦ç”¨**ï¼šç‚¹å‡»ç”µæºå›¾æ ‡åˆ‡æ¢çŠ¶æ€
- **åˆ é™¤å¥—é¤**ï¼šç‚¹å‡»åˆ é™¤å›¾æ ‡ï¼ˆéœ€ç¡®è®¤ï¼‰

#### Credité…ç½®ï¼ˆ/admin/settingsï¼‰
- åœ¨"Credit æ”¯ä»˜"åŒºåŸŸé…ç½®æ‰€æœ‰å‚æ•°
- ç¡®ä¿Notify URLå¯ä»¥è¢«å¤–ç½‘è®¿é—®
- ä¿å­˜åç«‹å³ç”Ÿæ•ˆ

### ç”¨æˆ·åŠŸèƒ½

#### è´­ä¹°å¥—é¤ï¼ˆ/packagesï¼‰
1. æµè§ˆå¯ç”¨å¥—é¤
2. ç‚¹å‡»"ç«‹å³è´­ä¹°"
3. è·³è½¬åˆ°Linux Do Creditæ”¯ä»˜é¡µé¢
4. å®Œæˆæ”¯ä»˜
5. è‡ªåŠ¨è·³è½¬å›å¥—é¤é¡µé¢

#### æŸ¥çœ‹å¥—é¤çŠ¶æ€ï¼ˆ/dashboardï¼‰
- å¦‚æœæœ‰æ´»è·ƒå¥—é¤ï¼Œæ˜¾ç¤ºï¼š
  - å¥—é¤åç§°
  - ä»Šæ—¥å·²ç”¨é¢åº¦
  - æ¯æ—¥é™é¢
  - å‰©ä½™é¢åº¦
  - è¿›åº¦æ¡
  - åˆ°æœŸæ—¥æœŸ
- å¦‚æœæ²¡æœ‰å¥—é¤ï¼Œæ˜¾ç¤ºè´­ä¹°æç¤º

## ğŸ”§ å·¥ä½œåŸç†

### è®¡è´¹æµç¨‹
```
ç”¨æˆ·å‘èµ·APIè¯·æ±‚
    â†“
è®¡ç®—æœ¬æ¬¡è´¹ç”¨
    â†“
æ£€æŸ¥æ˜¯å¦æœ‰æ´»è·ƒå¥—é¤ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ æ£€æŸ¥ä»Šæ—¥å·²ç”¨é¢åº¦
    â”‚       â”œâ”€ å¥—é¤é¢åº¦è¶³å¤Ÿ â†’ ä»å¥—é¤æ‰£é™¤ âœ“
    â”‚       â”œâ”€ å¥—é¤é¢åº¦ä¸è¶³ â†’ éƒ¨åˆ†ä»å¥—é¤ï¼Œéƒ¨åˆ†ä»ä½™é¢ âœ“
    â”‚       â””â”€ å¥—é¤é¢åº¦ç”¨å®Œ â†’ å…¨éƒ¨ä»ä½™é¢æ‰£é™¤ âœ“
    â””â”€ å¦ â†’ ç›´æ¥ä»ä½™é¢æ‰£é™¤ âœ“
```

### æ”¯ä»˜æµç¨‹
```
ç”¨æˆ·é€‰æ‹©å¥—é¤
    â†“
åˆ›å»ºæ”¯ä»˜è®¢å•
    â†“
ç”ŸæˆCreditæ”¯ä»˜URLå’Œç­¾å
    â†“
è·³è½¬åˆ°Creditæ”¯ä»˜é¡µé¢
    â†“
ç”¨æˆ·å®Œæˆæ”¯ä»˜
    â†“
Creditå›è°ƒnotify URL
    â†“
éªŒè¯ç­¾å
    â†“
åˆ›å»ºç”¨æˆ·å¥—é¤è®°å½•
    â†“
è¿”å›successç»™Credit
    â†“
ç”¨æˆ·è·³è½¬å›return URL
```

### æ¯æ—¥é‡ç½®
- æ—¶åŒºï¼šUTC+8ï¼ˆAsia/Shanghaiï¼‰
- é‡ç½®æ—¶é—´ï¼šæ¯å¤©0ç‚¹
- è‡ªåŠ¨é‡ç½®ï¼šç”¨æˆ·å¯ä»¥ç»§ç»­ä½¿ç”¨æ–°çš„æ¯æ—¥é¢åº¦
- å¥—é¤åˆ°æœŸï¼šè‡ªåŠ¨æ ‡è®°ä¸ºexpiredçŠ¶æ€

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### å¥—é¤ç³»ç»Ÿ
- âœ… çµæ´»çš„å¥—é¤é…ç½®ï¼ˆä»·æ ¼ã€æœ‰æ•ˆæœŸã€æ¯æ—¥é™é¢ï¼‰
- âœ… å¥—é¤æ’åºå’ŒçŠ¶æ€ç®¡ç†
- âœ… å¤šå¥—é¤æ”¯æŒï¼ˆç”¨æˆ·å¯ä»¥è´­ä¹°å¤šä¸ªå¥—é¤ï¼‰
- âœ… è‡ªåŠ¨è¿‡æœŸæ£€æŸ¥ï¼ˆæ¯å°æ—¶è¿è¡Œä¸€æ¬¡ï¼‰

### è®¡è´¹ç³»ç»Ÿ
- âœ… ä¼˜å…ˆä½¿ç”¨å¥—é¤é¢åº¦
- âœ… å¥—é¤é¢åº¦ç”¨å®Œè‡ªåŠ¨åˆ‡æ¢åˆ°ä½™é¢
- âœ… æ¯æ—¥0ç‚¹è‡ªåŠ¨é‡ç½®é¢åº¦
- âœ… æ”¯æŒå¥—é¤å’Œä½™é¢æ··åˆæ‰£è´¹

### æ”¯ä»˜ç³»ç»Ÿ
- âœ… Linux Do Credité›†æˆ
- âœ… MD5ç­¾åéªŒè¯
- âœ… å¼‚æ­¥å›è°ƒå¤„ç†
- âœ… å¹‚ç­‰æ€§ä¿è¯ï¼ˆé˜²æ­¢é‡å¤å¤„ç†ï¼‰
- âœ… äº‹åŠ¡å¤„ç†ï¼ˆç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼‰

### ç”¨æˆ·ä½“éªŒ
- âœ… å®æ—¶æ˜¾ç¤ºå¥—é¤çŠ¶æ€
- âœ… å¯è§†åŒ–è¿›åº¦æ¡
- âœ… æ¸…æ™°çš„é¢åº¦æç¤º
- âœ… æ— ç¼æ”¯ä»˜ä½“éªŒ
- âœ… å“åº”å¼è®¾è®¡

## ğŸ“Š æ•°æ®åº“è¡¨

### packagesï¼ˆå¥—é¤é…ç½®ï¼‰
- id, name, description
- price, duration_days, daily_limit
- status, sort_order
- created_at, updated_at

### user_packagesï¼ˆç”¨æˆ·å¥—é¤ï¼‰
- id, user_id, package_id
- package_name, package_price
- duration_days, daily_limit
- start_date, end_date, status
- created_at, updated_at

### daily_usageï¼ˆæ¯æ—¥ä½¿ç”¨ï¼‰
- id, user_id, user_package_id
- date, used_amount
- created_at, updated_at

### payment_ordersï¼ˆæ”¯ä»˜è®¢å•ï¼‰
- id, user_id, package_id
- order_no, out_trade_no, trade_no
- amount, status, payment_method
- payment_data, notify_data
- created_at, updated_at, paid_at

## ğŸ” å®‰å…¨æ³¨æ„äº‹é¡¹

1. **Creditå¯†é’¥å®‰å…¨**
   - PIDå’ŒKeyè¯·å¦¥å–„ä¿ç®¡
   - ä¸è¦åœ¨å‰ç«¯æš´éœ²å¯†é’¥
   - å®šæœŸæ›´æ¢å¯†é’¥

2. **å›è°ƒURLå®‰å…¨**
   - Notify URLå¿…é¡»ä½¿ç”¨HTTPS
   - å¿…é¡»éªŒè¯ç­¾å
   - é˜²æ­¢é‡æ”¾æ”»å‡»

3. **æ”¯ä»˜å®‰å…¨**
   - è®¢å•çŠ¶æ€æ£€æŸ¥
   - é‡‘é¢éªŒè¯
   - äº‹åŠ¡å¤„ç†

## ğŸ› æ•…éšœæ’æŸ¥

### æ”¯ä»˜å›è°ƒå¤±è´¥
1. æ£€æŸ¥Notify URLæ˜¯å¦å¯è®¿é—®
2. æ£€æŸ¥ç­¾åéªŒè¯é€»è¾‘
3. æŸ¥çœ‹åç«¯æ—¥å¿—
4. ç¡®è®¤Credité…ç½®æ­£ç¡®

### å¥—é¤æœªæ¿€æ´»
1. æ£€æŸ¥æ”¯ä»˜è®¢å•çŠ¶æ€
2. æŸ¥çœ‹payment_ordersè¡¨
3. æ£€æŸ¥user_packagesè¡¨
4. æŸ¥çœ‹åç«¯æ—¥å¿—

### æ¯æ—¥é¢åº¦æœªé‡ç½®
1. æ£€æŸ¥æ—¶åŒºé…ç½®ï¼ˆåº”ä¸ºUTC+8ï¼‰
2. æŸ¥çœ‹daily_usageè¡¨
3. ç¡®è®¤å¥—é¤æœªè¿‡æœŸ

### è®¡è´¹å¼‚å¸¸
1. æ£€æŸ¥å¥—é¤çŠ¶æ€
2. æŸ¥çœ‹daily_usageè®°å½•
3. æ£€æŸ¥ä½™é¢æ˜¯å¦å……è¶³
4. æŸ¥çœ‹usage_logsè¡¨

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. åç«¯æ—¥å¿—ï¼š`docker compose logs backend`
2. æ•°æ®åº“æ•°æ®ï¼šä½¿ç”¨æä¾›çš„SQLæŸ¥è¯¢
3. å‰ç«¯æ§åˆ¶å°ï¼šæµè§ˆå™¨å¼€å‘è€…å·¥å…·

## ğŸ‰ å®Œæˆï¼

å¥—é¤+æ”¯ä»˜ç³»ç»Ÿå·²å®Œå…¨å®ç°å¹¶å¯ä»¥æŠ•å…¥ä½¿ç”¨ã€‚ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼
