# 管理员面板使用指南

## 📋 功能概览

管理员面板提供了完整的系统管理功能，包括用户管理、系统设置、统计分析和操作审计。

---

## 🔐 访问管理员面板

### 1. 创建管理员账户

**方式一：数据库直接修改**（首次设置）

```sql
-- 将现有用户提升为管理员
UPDATE users SET role = 'admin' WHERE email = 'your-email@example.com';

-- 或创建超级管理员
UPDATE users SET role = 'super_admin' WHERE email = 'your-email@example.com';
```

**方式二：通过环境变量**（未来实现）

```bash
INITIAL_ADMIN_EMAIL=admin@example.com
INITIAL_ADMIN_PASSWORD=your-secure-password
```

### 2. 登录并访问

1. 使用管理员账户登录系统
2. 访问 `http://localhost:3000/admin`
3. 系统会自动验证您的管理员权限

---

## 📊 Dashboard（系统概览）

访问路径：`/admin`

### 功能

- **总用户数**：显示系统中的总用户数和活跃用户数
- **总收入**：显示系统总收入和今日收入
- **总消费**：显示用户总消费和系统利润
- **API密钥数**：显示总API密钥数和今日请求数

### 快速操作

- 点击卡片可快速跳转到对应的管理页面

---

## 👥 用户管理

访问路径：`/admin/users`

### 用户列表功能

#### 搜索和筛选
- **邮箱搜索**：输入邮箱关键词搜索用户
- **状态筛选**：按用户状态筛选（活跃/暂停/封禁）
- **分页浏览**：每页显示20个用户

#### 用户操作
- **查看详情**：点击眼睛图标查看用户详细信息
- **暂停用户**：点击暂停图标暂停用户账户
- **激活用户**：点击激活图标恢复用户账户

### 用户详情页面

访问路径：`/admin/users/[id]`

#### 基本信息
- 邮箱地址
- 用户ID
- 账户状态
- 用户角色
- 注册时间

#### 统计数据
- **账户余额**：当前余额，可点击调整
- **API密钥数量**：用户创建的API密钥总数
- **总消费**：用户累计消费金额
- **总Token数**：用户累计使用的Token数量

#### 余额调整
1. 点击余额卡片上的"$"图标
2. 输入调整金额（正数为充值，负数为扣除）
3. 填写调整说明
4. 点击确认

**示例**：
- 充值100元：输入 `100`
- 扣除50元：输入 `-50`

---

## ⚙️ 系统设置

访问路径：`/admin/settings`

### 可配置项

#### 1. 系统公告
- 在Dashboard显示给所有用户
- 支持多行文本
- 实时生效

#### 2. 新用户默认余额
- 设置新注册用户的初始余额
- 默认值：0
- 单位：美元

#### 3. 最小充值金额
- 设置用户单次充值的最小金额
- 默认值：10
- 单位：美元

#### 4. 注册开关
- 控制是否允许新用户注册
- 关闭后注册页面将不可用

### 保存设置
点击右上角的"保存设置"按钮保存所有修改。

---

## 📝 操作日志

访问路径：`/admin/logs`

### 功能

查看所有管理员的操作记录，包括：

- **时间**：操作发生的时间
- **操作**：操作类型（update_balance、update_user_status等）
- **目标**：操作的目标对象（用户ID等）
- **详情**：操作的详细信息
- **IP地址**：操作者的IP地址

### 日志类型

- `update_balance`：调整用户余额
- `update_user_status`：更新用户状态
- `update_settings`：更新系统设置

### 分页
每页显示50条记录，可通过底部分页按钮浏览。

---

## 🔒 权限说明

### 角色类型

1. **user**（普通用户）
   - 无法访问管理员面板
   - 只能管理自己的账户

2. **admin**（管理员）
   - 可以访问所有管理功能
   - 可以管理用户和系统设置
   - 操作会被记录到日志

3. **super_admin**（超级管理员）
   - 拥有所有管理员权限
   - 未来可能有额外的高级功能

### 权限验证

- **前端验证**：布局组件会检查用户角色
- **后端验证**：所有API端点都有双重验证（JWT + Admin Role）
- **审计追踪**：所有管理员操作都会记录到日志

---

## 💡 使用建议

### 日常管理

1. **每日检查Dashboard**
   - 查看今日收入和请求数
   - 关注用户增长趋势

2. **定期审查用户**
   - 检查异常消费用户
   - 处理用户反馈和问题

3. **监控操作日志**
   - 定期查看管理员操作
   - 发现异常操作及时处理

### 安全建议

1. **保护管理员账户**
   - 使用强密码
   - 不要共享管理员账户
   - 定期更换密码

2. **谨慎操作**
   - 调整余额前仔细核对
   - 封禁用户前了解原因
   - 修改系统设置前备份

3. **审计追踪**
   - 所有操作都会被记录
   - 包含操作者、时间、IP地址
   - 日志不可删除

---

## 🚀 常见操作流程

### 为用户充值

1. 进入"用户管理"
2. 搜索用户邮箱
3. 点击查看详情
4. 点击余额卡片的"$"图标
5. 输入充值金额（正数）
6. 填写充值说明（如"用户充值100元"）
7. 点击确认

### 暂停违规用户

1. 进入"用户管理"
2. 找到目标用户
3. 点击暂停图标
4. 系统会自动记录操作

### 修改系统公告

1. 进入"系统设置"
2. 在"系统公告"文本框输入内容
3. 点击"保存设置"
4. 用户Dashboard会立即显示新公告

---

## 📞 技术支持

如遇到问题：

1. 检查浏览器控制台错误
2. 查看后端日志
3. 确认用户角色是否正确
4. 提交GitHub Issue

---

## 🔄 未来功能

计划中的功能：

- [ ] 批量用户操作
- [ ] 数据导出功能
- [ ] 更详细的统计图表
- [ ] 邮件通知功能
- [ ] 自动化规则设置
- [ ] API速率限制配置

---

**最后更新**：2026-01-19
**版本**：v1.1.0
