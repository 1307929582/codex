# 🎬 Codex Gateway 功能演示

完整的功能演示和使用流程指南。

---

## 📦 第一步：部署系统

### 零配置部署

```bash
# 克隆代码
git clone https://github.com/1307929582/codex.git
cd codex

# 一键部署
./deploy-auto.sh
```

**输出示例**：
```
================================
  Codex Gateway 一键部署
================================

[1/7] 检查系统要求...
✓ Docker已安装

[2/7] 停止现有服务...

[3/7] 生成配置文件...
✓ 配置文件已生成
注意: 数据库密码和JWT密钥已自动生成

[4/7] 构建Docker镜像...
[+] Building 45.2s

[5/7] 启动服务...
[+] Running 3/3
 ✔ Container codex-postgres  Started
 ✔ Container codex-backend   Started
 ✔ Container codex-frontend  Started

[6/7] 等待服务就绪...
等待数据库启动 ✓
等待后端启动 ✓

[7/7] 检查管理员账户...
未找到管理员账户

================================
部署完成！
================================

访问地址：
  前端:        http://localhost:3000
  管理员面板:  http://localhost:3000/admin
  后端API:     http://localhost:8080
```

---

## 🎯 第二步：首次安装向导

### 自动跳转

打开浏览器访问 `http://localhost:3000`，系统自动检测到没有管理员，跳转到 `/setup`。

### Step 1: 创建管理员账户

```
┌─────────────────────────────────────┐
│   欢迎使用 Codex Gateway            │
│   首次安装向导 - 第 1 / 3 步       │
└─────────────────────────────────────┘

进度条: ████████░░░░░░░░░░░░
        创建管理员  配置OpenAI  系统设置

┌─────────────────────────────────────┐
│ 创建管理员账户                      │
│                                     │
│ 邮箱地址                            │
│ ┌─────────────────────────────────┐ │
│ │ admin@example.com               │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 密码                                │
│ ┌─────────────────────────────────┐ │
│ │ ••••••••                        │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 确认密码                            │
│ ┌─────────────────────────────────┐ │
│ │ ••••••••                        │ │
│ └─────────────────────────────────┘ │
│                                     │
│                    [ 下一步 ]       │
└─────────────────────────────────────┘
```

### Step 2: 配置OpenAI

```
┌─────────────────────────────────────┐
│   欢迎使用 Codex Gateway            │
│   首次安装向导 - 第 2 / 3 步       │
└─────────────────────────────────────┘

进度条: ████████████████░░░░░░░░
        创建管理员  配置OpenAI  系统设置

┌─────────────────────────────────────┐
│ 配置OpenAI                          │
│                                     │
│ OpenAI API密钥                      │
│ ┌─────────────────────────────────┐ │
│ │ sk-proj-...                     │ │
│ └─────────────────────────────────┘ │
│ 从 platform.openai.com/api-keys    │
│ 获取                                │
│                                     │
│ OpenAI Base URL（可选）             │
│ ┌─────────────────────────────────┐ │
│ │ https://api.openai.com/v1       │ │
│ └─────────────────────────────────┘ │
│ 如果使用代理，请修改此URL           │
│                                     │
│  [ 上一步 ]          [ 下一步 ]    │
└─────────────────────────────────────┘
```

### Step 3: 系统设置

```
┌─────────────────────────────────────┐
│   欢迎使用 Codex Gateway            │
│   首次安装向导 - 第 3 / 3 步       │
└─────────────────────────────────────┘

进度条: ████████████████████████
        创建管理员  配置OpenAI  系统设置

┌─────────────────────────────────────┐
│ 系统设置                            │
│                                     │
│ 系统公告（可选）                    │
│ ┌─────────────────────────────────┐ │
│ │ 欢迎使用Codex Gateway！         │ │
│ │                                 │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 新用户默认余额                      │
│ ┌─────────────────────────────────┐ │
│ │ 0                               │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ☑ 允许新用户注册                   │
│                                     │
│  [ 上一步 ]        [ 完成设置 ]    │
└─────────────────────────────────────┘
```

### 完成！

点击"完成设置"后：
1. ✅ 创建管理员账户
2. ✅ 保存OpenAI配置
3. ✅ 保存系统设置
4. ✅ 自动登录
5. ✅ 跳转到管理员面板

---

## 🛡️ 第三步：管理员面板

### Dashboard（系统概览）

访问 `http://localhost:3000/admin`

```
┌─────────────────────────────────────────────────────────┐
│ Codex Gateway 管理面板                                  │
│ admin@example.com                                       │
└─────────────────────────────────────────────────────────┘

┌─────────────┬─────────────┬─────────────┬─────────────┐
│ 总用户数    │ 总收入      │ 总消费      │ API密钥数   │
│             │             │             │             │
│    156      │  $1,234.56  │  $987.65    │    342      │
│ +12 今日    │ +$45.67 今日│ +$32.10 今日│ +8 今日     │
└─────────────┴─────────────┴─────────────┴─────────────┘

系统公告
┌─────────────────────────────────────────────────────────┐
│ 欢迎使用Codex Gateway！                                 │
└─────────────────────────────────────────────────────────┘
```

### 用户管理

访问 `http://localhost:3000/admin/users`

```
┌─────────────────────────────────────────────────────────┐
│ 用户管理                                                │
│                                                         │
│ 搜索: [user@example.com        ] 状态: [全部 ▼]       │
└─────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│ 邮箱              │ 余额    │ 状态   │ 注册时间  │ 操作 │
├──────────────────────────────────────────────────────────┤
│ user1@example.com │ $10.50  │ 活跃   │ 2026-01-15│ 👁 ⏸ │
│ user2@example.com │ $25.00  │ 活跃   │ 2026-01-16│ 👁 ⏸ │
│ user3@example.com │ $0.00   │ 暂停   │ 2026-01-17│ 👁 ▶ │
└──────────────────────────────────────────────────────────┘

                    [ 1 ] 2 3 ... 10
```

**操作示例**：

1. **查看用户详情**：点击 👁 图标
2. **暂停用户**：点击 ⏸ 图标
3. **激活用户**：点击 ▶ 图标

### 用户详情页

访问 `http://localhost:3000/admin/users/[id]`

```
┌─────────────────────────────────────────────────────────┐
│ 用户详情                                                │
└─────────────────────────────────────────────────────────┘

基本信息
┌─────────────────────────────────────────────────────────┐
│ 邮箱: user1@example.com                                 │
│ 用户ID: 123e4567-e89b-12d3-a456-426614174000           │
│ 状态: 活跃                                              │
│ 角色: 普通用户                                          │
│ 注册时间: 2026-01-15 10:30:00                          │
└─────────────────────────────────────────────────────────┘

统计数据
┌──────────────┬──────────────┬──────────────┬──────────────┐
│ 账户余额     │ API密钥数    │ 总消费       │ 总Token数    │
│              │              │              │              │
│  $10.50  💰  │      3       │   $45.67     │   125,430    │
└──────────────┴──────────────┴──────────────┴──────────────┘

点击 💰 图标调整余额
```

**调整余额对话框**：

```
┌─────────────────────────────────────┐
│ 调整用户余额                        │
│                                     │
│ 当前余额: $10.50                    │
│                                     │
│ 调整金额                            │
│ ┌─────────────────────────────────┐ │
│ │ 100                             │ │
│ └─────────────────────────────────┘ │
│ 正数为充值，负数为扣除              │
│                                     │
│ 调整说明                            │
│ ┌─────────────────────────────────┐ │
│ │ 用户充值100元                   │ │
│ └─────────────────────────────────┘ │
│                                     │
│  [ 取消 ]            [ 确认 ]      │
└─────────────────────────────────────┘
```

### 系统设置

访问 `http://localhost:3000/admin/settings`

```
┌─────────────────────────────────────────────────────────┐
│ 系统设置                              [ 保存设置 ]      │
└─────────────────────────────────────────────────────────┘

OpenAI配置
┌─────────────────────────────────────────────────────────┐
│ OpenAI API密钥                                          │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ sk-proj-••••••••••••••••••••                        │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ OpenAI Base URL                                         │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ https://api.openai.com/v1                           │ │
│ └─────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘

系统公告
┌─────────────────────────────────────────────────────────┐
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 欢迎使用Codex Gateway！                             │ │
│ │                                                     │ │
│ └─────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘

用户设置
┌─────────────────────────────────────────────────────────┐
│ 新用户默认余额                                          │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 0                                                   │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 最小充值金额                                            │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 10                                                  │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ ☑ 允许新用户注册                                       │
└─────────────────────────────────────────────────────────┘
```

### 操作日志

访问 `http://localhost:3000/admin/logs`

```
┌─────────────────────────────────────────────────────────┐
│ 操作日志                                                │
└─────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│ 时间              │ 操作          │ 目标    │ IP地址      │
├──────────────────────────────────────────────────────────┤
│ 2026-01-19 14:30 │ update_balance│ user123 │ 192.168.1.1│
│ 详情: 充值 $100.00                                       │
├──────────────────────────────────────────────────────────┤
│ 2026-01-19 14:25 │ update_status │ user456 │ 192.168.1.1│
│ 详情: 暂停用户                                           │
├──────────────────────────────────────────────────────────┤
│ 2026-01-19 14:20 │ update_settings│ system │ 192.168.1.1│
│ 详情: 更新系统设置                                       │
└──────────────────────────────────────────────────────────┘

                    [ 1 ] 2 3 ... 10
```

---

## 👤 第四步：普通用户使用

### 用户注册

访问 `http://localhost:3000/register`

```
┌─────────────────────────────────────┐
│ 注册账户                            │
│                                     │
│ 邮箱                                │
│ ┌─────────────────────────────────┐ │
│ │ user@example.com                │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 密码                                │
│ ┌─────────────────────────────────┐ │
│ │ ••••••••                        │ │
│ └─────────────────────────────────┘ │
│                                     │
│           [ 注册 ]                  │
│                                     │
│ 已有账户？ 登录                     │
└─────────────────────────────────────┘
```

### 用户Dashboard

访问 `http://localhost:3000/dashboard`

```
┌─────────────────────────────────────────────────────────┐
│ Codex Gateway                                           │
│ user@example.com                                        │
└─────────────────────────────────────────────────────────┘

系统公告
┌─────────────────────────────────────────────────────────┐
│ 欢迎使用Codex Gateway！                                 │
└─────────────────────────────────────────────────────────┘

账户概览
┌──────────────┬──────────────┬──────────────┬──────────────┐
│ 账户余额     │ API密钥数    │ 今日消费     │ 今日请求数   │
│              │              │              │              │
│   $10.50     │      3       │    $2.34     │     156      │
└──────────────┴──────────────┴──────────────┴──────────────┘

快速操作
┌─────────────────────────────────────────────────────────┐
│ [ 创建API密钥 ]  [ 查看使用记录 ]  [ 账户设置 ]        │
└─────────────────────────────────────────────────────────┘
```

### API密钥管理

访问 `http://localhost:3000/api-keys`

```
┌─────────────────────────────────────────────────────────┐
│ API密钥管理                          [ + 创建新密钥 ]   │
└─────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│ 名称        │ 密钥                    │ 创建时间  │ 操作 │
├──────────────────────────────────────────────────────────┤
│ 生产环境    │ sk-abc123...            │ 2026-01-15│ 📋 🗑 │
│ 测试环境    │ sk-def456...            │ 2026-01-16│ 📋 🗑 │
│ 开发环境    │ sk-ghi789...            │ 2026-01-17│ 📋 🗑 │
└──────────────────────────────────────────────────────────┘

📋 = 复制密钥
🗑 = 删除密钥
```

**创建新密钥**：

```
┌─────────────────────────────────────┐
│ 创建API密钥                         │
│                                     │
│ 密钥名称                            │
│ ┌─────────────────────────────────┐ │
│ │ 我的应用                        │ │
│ └─────────────────────────────────┘ │
│                                     │
│  [ 取消 ]            [ 创建 ]      │
└─────────────────────────────────────┘
```

**创建成功**：

```
┌─────────────────────────────────────┐
│ API密钥创建成功！                   │
│                                     │
│ 请妥善保管您的密钥，此密钥只显示一次│
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ sk-abc123def456ghi789...        │ │
│ └─────────────────────────────────┘ │
│                                     │
│           [ 复制密钥 ]              │
└─────────────────────────────────────┘
```

### 使用记录

访问 `http://localhost:3000/usage`

```
┌─────────────────────────────────────────────────────────┐
│ 使用记录                                                │
│                                                         │
│ 日期范围: [2026-01-01] 至 [2026-01-19]                │
└─────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│ 时间              │ 模型          │ Tokens │ 费用       │
├──────────────────────────────────────────────────────────┤
│ 2026-01-19 14:30 │ gpt-4         │ 1,234  │ $0.0370   │
│ 2026-01-19 14:25 │ gpt-3.5-turbo │   456  │ $0.0007   │
│ 2026-01-19 14:20 │ gpt-4         │ 2,345  │ $0.0704   │
└──────────────────────────────────────────────────────────┘

总计: 3,035 tokens, $0.1081

                    [ 1 ] 2 3 ... 10
```

---

## 🔌 第五步：API调用

### 使用API密钥调用

```bash
# 使用创建的API密钥调用OpenAI API
curl -X POST http://localhost:8080/v1/chat/completions \
  -H "Authorization: Bearer sk-abc123def456ghi789..." \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gpt-3.5-turbo",
    "messages": [
      {
        "role": "user",
        "content": "Hello, how are you?"
      }
    ]
  }'
```

**响应**：

```json
{
  "id": "chatcmpl-123",
  "object": "chat.completion",
  "created": 1706529600,
  "model": "gpt-3.5-turbo",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "I'm doing well, thank you! How can I help you today?"
      },
      "finish_reason": "stop"
    }
  ],
  "usage": {
    "prompt_tokens": 13,
    "completion_tokens": 15,
    "total_tokens": 28
  }
}
```

### 自动计费

调用完成后：
1. ✅ 自动计算费用（根据模型定价）
2. ✅ 从用户余额扣除
3. ✅ 记录使用日志
4. ✅ 更新统计数据

---

## 📊 完整功能清单

### ✅ 部署功能
- [x] 一键部署脚本
- [x] 自动生成配置
- [x] Docker容器化
- [x] 健康检查
- [x] 首次安装向导

### ✅ 管理员功能
- [x] Dashboard统计
- [x] 用户管理（查看、搜索、筛选）
- [x] 用户详情（余额、统计）
- [x] 余额调整（充值/扣除）
- [x] 用户状态管理（暂停/激活）
- [x] OpenAI配置（API密钥、Base URL）
- [x] 系统设置（公告、默认余额、注册开关）
- [x] 操作日志（审计追踪）

### ✅ 用户功能
- [x] 注册/登录
- [x] Dashboard概览
- [x] API密钥管理（创建、查看、删除）
- [x] 使用记录查询
- [x] 账户信息管理

### ✅ API功能
- [x] OpenAI API代理
- [x] 自动计费
- [x] 余额检查
- [x] 使用量统计
- [x] 错误处理

### ✅ 安全功能
- [x] JWT认证
- [x] 角色权限控制
- [x] API密钥验证
- [x] 请求限流
- [x] 操作审计

---

## 🎉 总结

Codex Gateway提供了：

1. **零配置部署**：一个命令完成部署
2. **Web界面配置**：所有设置在浏览器完成
3. **完整管理功能**：用户、系统、OpenAI全面管理
4. **自动计费系统**：精确到Token的计费
5. **企业级安全**：认证、授权、审计完整

现在您可以立即开始使用Codex Gateway！

---

**最后更新**：2026-01-19
**版本**：v2.0.0
